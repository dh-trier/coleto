<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, minimum-scale=1" />
<meta name="generator" content="pdoc 0.9.2" />
<title>coleto.stats_progression API documentation</title>
<meta name="description" content="Calculates edit intensity over textual progression.
Focuses on cumulated Levenshtein distances.
Reports them per category of edit and per sentence …" />
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/sanitize.min.css" integrity="sha256-PK9q560IAAa6WVRRh76LtCaI8pjTJ2z11v0miyNNjrs=" crossorigin>
<link rel="preload stylesheet" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/10up-sanitize.css/11.0.1/typography.min.css" integrity="sha256-7l/o7C8jubJiy74VsKTidCy1yBkRtiUGbVkYBylBqUg=" crossorigin>
<link rel="stylesheet preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/github.min.css" crossorigin>
<style>:root{--highlight-color:#fe9}.flex{display:flex !important}body{line-height:1.5em}#content{padding:20px}#sidebar{padding:30px;overflow:hidden}#sidebar > *:last-child{margin-bottom:2cm}.http-server-breadcrumbs{font-size:130%;margin:0 0 15px 0}#footer{font-size:.75em;padding:5px 30px;border-top:1px solid #ddd;text-align:right}#footer p{margin:0 0 0 1em;display:inline-block}#footer p:last-child{margin-right:30px}h1,h2,h3,h4,h5{font-weight:300}h1{font-size:2.5em;line-height:1.1em}h2{font-size:1.75em;margin:1em 0 .50em 0}h3{font-size:1.4em;margin:25px 0 10px 0}h4{margin:0;font-size:105%}h1:target,h2:target,h3:target,h4:target,h5:target,h6:target{background:var(--highlight-color);padding:.2em 0}a{color:#058;text-decoration:none;transition:color .3s ease-in-out}a:hover{color:#e82}.title code{font-weight:bold}h2[id^="header-"]{margin-top:2em}.ident{color:#900}pre code{background:#f8f8f8;font-size:.8em;line-height:1.4em}code{background:#f2f2f1;padding:1px 4px;overflow-wrap:break-word}h1 code{background:transparent}pre{background:#f8f8f8;border:0;border-top:1px solid #ccc;border-bottom:1px solid #ccc;margin:1em 0;padding:1ex}#http-server-module-list{display:flex;flex-flow:column}#http-server-module-list div{display:flex}#http-server-module-list dt{min-width:10%}#http-server-module-list p{margin-top:0}.toc ul,#index{list-style-type:none;margin:0;padding:0}#index code{background:transparent}#index h3{border-bottom:1px solid #ddd}#index ul{padding:0}#index h4{margin-top:.6em;font-weight:bold}@media (min-width:200ex){#index .two-column{column-count:2}}@media (min-width:300ex){#index .two-column{column-count:3}}dl{margin-bottom:2em}dl dl:last-child{margin-bottom:4em}dd{margin:0 0 1em 3em}#header-classes + dl > dd{margin-bottom:3em}dd dd{margin-left:2em}dd p{margin:10px 0}.name{background:#eee;font-weight:bold;font-size:.85em;padding:5px 10px;display:inline-block;min-width:40%}.name:hover{background:#e0e0e0}dt:target .name{background:var(--highlight-color)}.name > span:first-child{white-space:nowrap}.name.class > span:nth-child(2){margin-left:.4em}.inherited{color:#999;border-left:5px solid #eee;padding-left:1em}.inheritance em{font-style:normal;font-weight:bold}.desc h2{font-weight:400;font-size:1.25em}.desc h3{font-size:1em}.desc dt code{background:inherit}.source summary,.git-link-div{color:#666;text-align:right;font-weight:400;font-size:.8em;text-transform:uppercase}.source summary > *{white-space:nowrap;cursor:pointer}.git-link{color:inherit;margin-left:1em}.source pre{max-height:500px;overflow:auto;margin:0}.source pre code{font-size:12px;overflow:visible}.hlist{list-style:none}.hlist li{display:inline}.hlist li:after{content:',\2002'}.hlist li:last-child:after{content:none}.hlist .hlist{display:inline;padding-left:1em}img{max-width:100%}td{padding:0 .5em}.admonition{padding:.1em .5em;margin-bottom:1em}.admonition-title{font-weight:bold}.admonition.note,.admonition.info,.admonition.important{background:#aef}.admonition.todo,.admonition.versionadded,.admonition.tip,.admonition.hint{background:#dfd}.admonition.warning,.admonition.versionchanged,.admonition.deprecated{background:#fd4}.admonition.error,.admonition.danger,.admonition.caution{background:lightpink}</style>
<style media="screen and (min-width: 700px)">@media screen and (min-width:700px){#sidebar{width:30%;height:100vh;overflow:auto;position:sticky;top:0}#content{width:70%;max-width:100ch;padding:3em 4em;border-left:1px solid #ddd}pre code{font-size:1em}.item .name{font-size:1em}main{display:flex;flex-direction:row-reverse;justify-content:flex-end}.toc ul ul,#index ul{padding-left:1.5em}.toc > ul > li{margin-top:.5em}}</style>
<style media="print">@media print{#sidebar h1{page-break-before:always}.source{display:none}}@media print{*{background:transparent !important;color:#000 !important;box-shadow:none !important;text-shadow:none !important}a[href]:after{content:" (" attr(href) ")";font-size:90%}a[href][title]:after{content:none}abbr[title]:after{content:" (" attr(title) ")"}.ir a:after,a[href^="javascript:"]:after,a[href^="#"]:after{content:""}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}img{max-width:100% !important}@page{margin:0.5cm}p,h2,h3{orphans:3;widows:3}h1,h2,h3,h4,h5,h6{page-break-after:avoid}}</style>
<script defer src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js" integrity="sha256-Uv3H6lx7dJmRfRvH8TH6kJD1TSK1aFcwgx+mdg3epi8=" crossorigin></script>
<script>window.addEventListener('DOMContentLoaded', () => hljs.initHighlighting())</script>
</head>
<body>
<main>
<article id="content">
<header>
<h1 class="title">Module <code>coleto.stats_progression</code></h1>
</header>
<section id="section-intro">
<p>Calculates edit intensity over textual progression.
Focuses on cumulated Levenshtein distances.
Reports them per category of edit and per sentence.</p>
<p>Part of coleto, see: <a href="https://github.com/dh-trier/coleto.">https://github.com/dh-trier/coleto.</a></p>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">#!/usr/bin/env python3
# -*- coding: utf-8 -*-
# Author: Christof Schöch, 2016-2021.

&#34;&#34;&#34;
Calculates edit intensity over textual progression.
Focuses on cumulated Levenshtein distances. 
Reports them per category of edit and per sentence.

Part of coleto, see: https://github.com/dh-trier/coleto.
&#34;&#34;&#34;


# === Imports ===

import re
import pandas as pd
from os.path import join
from os.path import basename


# === Functions ===


def read_datafile(analysisfile):
    &#34;&#34;&#34;Reads the output of &#39;analyze&#39;.
    Selects the relevant columns and turns them into a DataFrame.
    Returns the DataFrame.&#34;&#34;&#34;
    with open(analysisfile, &#34;r&#34;) as infile:
        data = pd.read_csv(
            infile,
            sep=&#34;\t&#34;,
            usecols=[&#34;itemid&#34;, &#34;category&#34;, &#34;lev-dist&#34;])
    # print(data.head(10))
    return data


def split_itemid(data):
    &#34;&#34;&#34;The column &#34;itemid&#34; contains the line number
    and the edit number per line.
    This function splits them apart.
    It then creates two new columns from this information.
    Returns the DataFrame.&#34;&#34;&#34;
    split = data[&#34;itemid&#34;].str.split(&#34;-&#34;, n=1, expand=True)
    data[&#34;line&#34;] = split[0]
    data[&#34;edit&#34;] = split[1]
    data.drop(columns=[&#34;itemid&#34;], inplace=True)
    # print(data.head(10))
    return data


def separate_categories(data):
    &#34;&#34;&#34;
    Separate the rows concerning &#34;script-identifiable edits&#34; from those
    concerning &#34;other edits&#34;.
    Also, in each categry, and for each line, calculate the sum of
    levenshtein distances across all edits for that line.
    Return two separate DataFrames.
    &#34;&#34;&#34;
    # Line 6 should have an entry in both other and script.
    data = data.groupby([&#34;category&#34;, &#34;line&#34;], axis=0).sum()
    other = data.loc[&#34;other&#34;, :].reset_index()\
        .astype(int).sort_values(by=[&#34;line&#34;])
    script = data.loc[&#34;script-identifiable&#34;, :]\
        .reset_index().astype(int).sort_values(by=[&#34;line&#34;])
    # print(script.head(), other.head())
    return other, script


def get_numsentences(analysissummaryfile):
    with open(analysissummaryfile, &#34;r&#34;, encoding=&#34;utf8&#34;) as infile: 
        summary = pd.read_csv(infile, sep=&#34;\t&#34;, index_col=0)
        numsentences = summary[&#34;numlines&#34;].values[0]
        return numsentences


def supply_emptylines(numsentences):
    &#34;&#34;&#34;
    Create a dummy DataFrame in which every line in the text has a row.
    This is simply to make a left merge possible to obtain a DataFrame
    that also has rows for lines where no edit took place.
    Returns a DataFrame.
    &#34;&#34;&#34;
    rows = range(1, numsentences)  # 11870 – 11479
    levs = [0] * numsentences  # 11870 – 11479
    empty = pd.DataFrame(
        list(zip(rows, levs)),
        columns=[&#34;line&#34;, &#34;lev-dist&#34;]).astype(int)
    # print(empty.head())
    return empty


def merge_frames(withdata, empty):
    &#34;&#34;&#34;Merge the dummy DataFrame with the DataFrames containing data.
    Creates a DataFrame with one row per line in the novel.
    Done once for other, once for script.
    Returns a DataFrame.&#34;&#34;&#34;

    merged = empty.merge(withdata, how=&#34;left&#34;, on=&#34;line&#34;).fillna(0)
    merged[&#34;lev-dist&#34;] = merged[&#34;lev-dist_x&#34;] + merged[&#34;lev-dist_y&#34;]
    merged.drop([&#34;lev-dist_x&#34;, &#34;lev-dist_y&#34;], axis=1, inplace=True)
    # print(merged.shape)
    # print(merged.head(10))
    return merged


def merge_again(other, script):
    &#34;&#34;&#34;
    Merge the two DataFrames for other and script together again,
    but keeping distinct rows for the cumulated levenshtein distances
    for each category (other and script).
    Returns DataFrame.
    &#34;&#34;&#34;
    data = other.merge(script, how=&#34;left&#34;, on=&#34;line&#34;)
    data.rename(columns={&#34;lev-dist_x&#34;: &#34;other&#34;, &#34;lev-dist_y&#34;: &#34;script&#34;},
                inplace=True)
    # print(data.head())
    return data


def save_data(data, filename):
    &#34;&#34;&#34;
    Saves the levenshtein distance data per category to a TSV file.
    &#34;&#34;&#34;
    with open(filename, &#34;w&#34;, encoding=&#34;utf8&#34;) as outfile:
        data.to_csv(outfile, sep=&#34;\t&#34;)
    print(&#34;Looking good: The Levenshtein distance data has been saved.&#34;)
    print(&#34;The file is called &#34; + basename(filename) + &#34;.&#34;)


def main(params):
    &#34;&#34;&#34;Coordinates the process of preparing the data for visualization.&#34;&#34;&#34;
    print(&#34;\n== coleto: running stats_progression.&#34;)
    data = read_datafile(params[&#34;analysis_file&#34;])
    data = split_itemid(data)
    other, script = separate_categories(data)
    numsentences = get_numsentences(params[&#34;analysissummary_file&#34;])
    empty = supply_emptylines(numsentences)
    other = merge_frames(other, empty)
    script = merge_frames(script, empty)
    data = merge_again(other, script)
    save_data(data, params[&#34;levdists_file&#34;])</code></pre>
</details>
</section>
<section>
</section>
<section>
</section>
<section>
<h2 class="section-title" id="header-functions">Functions</h2>
<dl>
<dt id="coleto.stats_progression.get_numsentences"><code class="name flex">
<span>def <span class="ident">get_numsentences</span></span>(<span>analysissummaryfile)</span>
</code></dt>
<dd>
<div class="desc"></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def get_numsentences(analysissummaryfile):
    with open(analysissummaryfile, &#34;r&#34;, encoding=&#34;utf8&#34;) as infile: 
        summary = pd.read_csv(infile, sep=&#34;\t&#34;, index_col=0)
        numsentences = summary[&#34;numlines&#34;].values[0]
        return numsentences</code></pre>
</details>
</dd>
<dt id="coleto.stats_progression.main"><code class="name flex">
<span>def <span class="ident">main</span></span>(<span>params)</span>
</code></dt>
<dd>
<div class="desc"><p>Coordinates the process of preparing the data for visualization.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def main(params):
    &#34;&#34;&#34;Coordinates the process of preparing the data for visualization.&#34;&#34;&#34;
    print(&#34;\n== coleto: running stats_progression.&#34;)
    data = read_datafile(params[&#34;analysis_file&#34;])
    data = split_itemid(data)
    other, script = separate_categories(data)
    numsentences = get_numsentences(params[&#34;analysissummary_file&#34;])
    empty = supply_emptylines(numsentences)
    other = merge_frames(other, empty)
    script = merge_frames(script, empty)
    data = merge_again(other, script)
    save_data(data, params[&#34;levdists_file&#34;])</code></pre>
</details>
</dd>
<dt id="coleto.stats_progression.merge_again"><code class="name flex">
<span>def <span class="ident">merge_again</span></span>(<span>other, script)</span>
</code></dt>
<dd>
<div class="desc"><p>Merge the two DataFrames for other and script together again,
but keeping distinct rows for the cumulated levenshtein distances
for each category (other and script).
Returns DataFrame.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def merge_again(other, script):
    &#34;&#34;&#34;
    Merge the two DataFrames for other and script together again,
    but keeping distinct rows for the cumulated levenshtein distances
    for each category (other and script).
    Returns DataFrame.
    &#34;&#34;&#34;
    data = other.merge(script, how=&#34;left&#34;, on=&#34;line&#34;)
    data.rename(columns={&#34;lev-dist_x&#34;: &#34;other&#34;, &#34;lev-dist_y&#34;: &#34;script&#34;},
                inplace=True)
    # print(data.head())
    return data</code></pre>
</details>
</dd>
<dt id="coleto.stats_progression.merge_frames"><code class="name flex">
<span>def <span class="ident">merge_frames</span></span>(<span>withdata, empty)</span>
</code></dt>
<dd>
<div class="desc"><p>Merge the dummy DataFrame with the DataFrames containing data.
Creates a DataFrame with one row per line in the novel.
Done once for other, once for script.
Returns a DataFrame.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def merge_frames(withdata, empty):
    &#34;&#34;&#34;Merge the dummy DataFrame with the DataFrames containing data.
    Creates a DataFrame with one row per line in the novel.
    Done once for other, once for script.
    Returns a DataFrame.&#34;&#34;&#34;

    merged = empty.merge(withdata, how=&#34;left&#34;, on=&#34;line&#34;).fillna(0)
    merged[&#34;lev-dist&#34;] = merged[&#34;lev-dist_x&#34;] + merged[&#34;lev-dist_y&#34;]
    merged.drop([&#34;lev-dist_x&#34;, &#34;lev-dist_y&#34;], axis=1, inplace=True)
    # print(merged.shape)
    # print(merged.head(10))
    return merged</code></pre>
</details>
</dd>
<dt id="coleto.stats_progression.read_datafile"><code class="name flex">
<span>def <span class="ident">read_datafile</span></span>(<span>analysisfile)</span>
</code></dt>
<dd>
<div class="desc"><p>Reads the output of 'analyze'.
Selects the relevant columns and turns them into a DataFrame.
Returns the DataFrame.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def read_datafile(analysisfile):
    &#34;&#34;&#34;Reads the output of &#39;analyze&#39;.
    Selects the relevant columns and turns them into a DataFrame.
    Returns the DataFrame.&#34;&#34;&#34;
    with open(analysisfile, &#34;r&#34;) as infile:
        data = pd.read_csv(
            infile,
            sep=&#34;\t&#34;,
            usecols=[&#34;itemid&#34;, &#34;category&#34;, &#34;lev-dist&#34;])
    # print(data.head(10))
    return data</code></pre>
</details>
</dd>
<dt id="coleto.stats_progression.save_data"><code class="name flex">
<span>def <span class="ident">save_data</span></span>(<span>data, filename)</span>
</code></dt>
<dd>
<div class="desc"><p>Saves the levenshtein distance data per category to a TSV file.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def save_data(data, filename):
    &#34;&#34;&#34;
    Saves the levenshtein distance data per category to a TSV file.
    &#34;&#34;&#34;
    with open(filename, &#34;w&#34;, encoding=&#34;utf8&#34;) as outfile:
        data.to_csv(outfile, sep=&#34;\t&#34;)
    print(&#34;Looking good: The Levenshtein distance data has been saved.&#34;)
    print(&#34;The file is called &#34; + basename(filename) + &#34;.&#34;)</code></pre>
</details>
</dd>
<dt id="coleto.stats_progression.separate_categories"><code class="name flex">
<span>def <span class="ident">separate_categories</span></span>(<span>data)</span>
</code></dt>
<dd>
<div class="desc"><p>Separate the rows concerning "script-identifiable edits" from those
concerning "other edits".
Also, in each categry, and for each line, calculate the sum of
levenshtein distances across all edits for that line.
Return two separate DataFrames.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def separate_categories(data):
    &#34;&#34;&#34;
    Separate the rows concerning &#34;script-identifiable edits&#34; from those
    concerning &#34;other edits&#34;.
    Also, in each categry, and for each line, calculate the sum of
    levenshtein distances across all edits for that line.
    Return two separate DataFrames.
    &#34;&#34;&#34;
    # Line 6 should have an entry in both other and script.
    data = data.groupby([&#34;category&#34;, &#34;line&#34;], axis=0).sum()
    other = data.loc[&#34;other&#34;, :].reset_index()\
        .astype(int).sort_values(by=[&#34;line&#34;])
    script = data.loc[&#34;script-identifiable&#34;, :]\
        .reset_index().astype(int).sort_values(by=[&#34;line&#34;])
    # print(script.head(), other.head())
    return other, script</code></pre>
</details>
</dd>
<dt id="coleto.stats_progression.split_itemid"><code class="name flex">
<span>def <span class="ident">split_itemid</span></span>(<span>data)</span>
</code></dt>
<dd>
<div class="desc"><p>The column "itemid" contains the line number
and the edit number per line.
This function splits them apart.
It then creates two new columns from this information.
Returns the DataFrame.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def split_itemid(data):
    &#34;&#34;&#34;The column &#34;itemid&#34; contains the line number
    and the edit number per line.
    This function splits them apart.
    It then creates two new columns from this information.
    Returns the DataFrame.&#34;&#34;&#34;
    split = data[&#34;itemid&#34;].str.split(&#34;-&#34;, n=1, expand=True)
    data[&#34;line&#34;] = split[0]
    data[&#34;edit&#34;] = split[1]
    data.drop(columns=[&#34;itemid&#34;], inplace=True)
    # print(data.head(10))
    return data</code></pre>
</details>
</dd>
<dt id="coleto.stats_progression.supply_emptylines"><code class="name flex">
<span>def <span class="ident">supply_emptylines</span></span>(<span>numsentences)</span>
</code></dt>
<dd>
<div class="desc"><p>Create a dummy DataFrame in which every line in the text has a row.
This is simply to make a left merge possible to obtain a DataFrame
that also has rows for lines where no edit took place.
Returns a DataFrame.</p></div>
<details class="source">
<summary>
<span>Expand source code</span>
</summary>
<pre><code class="python">def supply_emptylines(numsentences):
    &#34;&#34;&#34;
    Create a dummy DataFrame in which every line in the text has a row.
    This is simply to make a left merge possible to obtain a DataFrame
    that also has rows for lines where no edit took place.
    Returns a DataFrame.
    &#34;&#34;&#34;
    rows = range(1, numsentences)  # 11870 – 11479
    levs = [0] * numsentences  # 11870 – 11479
    empty = pd.DataFrame(
        list(zip(rows, levs)),
        columns=[&#34;line&#34;, &#34;lev-dist&#34;]).astype(int)
    # print(empty.head())
    return empty</code></pre>
</details>
</dd>
</dl>
</section>
<section>
</section>
</article>
<nav id="sidebar">
<h1>Index</h1>
<div class="toc">
<ul></ul>
</div>
<ul id="index">
<li><h3>Super-module</h3>
<ul>
<li><code><a title="coleto" href="index.html">coleto</a></code></li>
</ul>
</li>
<li><h3><a href="#header-functions">Functions</a></h3>
<ul class="two-column">
<li><code><a title="coleto.stats_progression.get_numsentences" href="#coleto.stats_progression.get_numsentences">get_numsentences</a></code></li>
<li><code><a title="coleto.stats_progression.main" href="#coleto.stats_progression.main">main</a></code></li>
<li><code><a title="coleto.stats_progression.merge_again" href="#coleto.stats_progression.merge_again">merge_again</a></code></li>
<li><code><a title="coleto.stats_progression.merge_frames" href="#coleto.stats_progression.merge_frames">merge_frames</a></code></li>
<li><code><a title="coleto.stats_progression.read_datafile" href="#coleto.stats_progression.read_datafile">read_datafile</a></code></li>
<li><code><a title="coleto.stats_progression.save_data" href="#coleto.stats_progression.save_data">save_data</a></code></li>
<li><code><a title="coleto.stats_progression.separate_categories" href="#coleto.stats_progression.separate_categories">separate_categories</a></code></li>
<li><code><a title="coleto.stats_progression.split_itemid" href="#coleto.stats_progression.split_itemid">split_itemid</a></code></li>
<li><code><a title="coleto.stats_progression.supply_emptylines" href="#coleto.stats_progression.supply_emptylines">supply_emptylines</a></code></li>
</ul>
</li>
</ul>
</nav>
</main>
<footer id="footer">
<p>Generated by <a href="https://pdoc3.github.io/pdoc"><cite>pdoc</cite> 0.9.2</a>.</p>
</footer>
</body>
</html>